# Introduction to Response Surface Methodology

Response surface methods are used to improve a product or process by repeated experimentation.  In many applications, several controllable input variables affect the response/output of an industrial, manufacturing, or other process.  

The sensitivity of the response to individual inputs may not be well understood, so *screening experiments*---often in the form of fractional factorial experiments---are used to identify the most important inputs.

Once the set of most important inputs has been identified additional experiments are performed to assess main effects or main effects with two-way interactions.  These are often $2^k$ factorial experiments, possibly with center-point replicates to estimate error variance and curvature.  The purpose of these experiments is very often to assess the response variable's *direction of steepest ascent* with respect to the inputs.  This can be used to propose new input variable values for follow-up experimental runs.  This process is an experimental/stochastic version of Newton's method for maximizing (or minimizing) a function, which is, in this case, the unknown regression function relating the inputs to the response.  

After a few iterations of steepest ascent, it is often advisable to conduct a new experiment with center point at the last iteration and using a design allowing for the fitting of a quadratic model in the inputs.  A quadratic model allows one to determine the curvature of the regression function---which, in the case of two inputs is a surface, hence *response surface*---and try to identify a local maximum response.  

The whole process is designed to identify a new region of the input space where better responses are likely to be realized.  Many issues may arise to further complicate this endeavor, including sample size constraints, input space constraints, and practical difficulties randomizing trials.  

We will discuss a few important concepts related to response surface methodology below, including fractional factorial experiments, steepest ascent, and quadratic models.

## Fractional factorial experiments

Factorial $2^k$ experiments contain many parameters---in fact, a saturated model consists of $\sum_{i=1}^k {k\choose i}$ parameters.  Without a large sample size, it is not possible to fit all parameters in a factorial experiment with a large number of inputs $k$.  

Instead, we often assume most higher-order interactions, say three-way and above, are exactly zero.  In practice, this means we assume the main effects and perhaps some interactions explain most of the variation in response.

A common way of reducing the number of parameters in a factorial experiment is to consider a fractional factorial.  The one-half fraction experiment is a $2^{k-1}$ experiment which can be generated by explicitly confounding the highest order interaction with the intercept.  For example, consider the following table depicting the design of a $2^3$ factorial experiment:<br>

| Intercept | A  | B  | C  | AB | AC | BC | ABC |
|-----------|----|----|----|----|----|----|-----|
| 1         | 1  | 1  | 1  | 1  | 1  | 1  | 1   |
| 1         | 1  | 1  | -1 | 1  | -1 | -1 | -1  |
| 1         | 1  | -1 | 1  | -1 | 1  | -1 | -1  |
| 1         | 1  | -1 | -1 | -1 | -1 | 1  | 1   |
| 1         | -1 | 1  | 1  | -1 | -1 | 1  | -1  |
| 1         | -1 | 1  | -1 | -1 | 1  | -1 | 1   |
| 1         | -1 | -1 | 1  | 1  | -1 | -1 | 1   |
| 1         | -1 | -1 | -1 | 1  | 1  | 1  | -1  |


<br>


The saturated model for a $2^3$ experiment contains 8 parameters including the intercept. A one-half fraction fractional factorial experiment may be generated by selecting the rows that confound the intercept with the three-way interaction.  In this example those are the rows 1,4,6,7.  The following sub-table shows this fractional factorial design:

| Intercept | A  | B  | C  | AB | AC | BC | ABC |
|-----------|----|----|----|----|----|----|-----|
| 1         | 1  | 1  | 1  | 1  | 1  | 1  | 1   |
| 1         | 1  | -1 | -1 | -1 | -1 | 1  | 1   |
| 1         | -1 | 1  | -1 | -1 | 1  | -1 | 1   |
| 1         | -1 | -1 | 1  | 1  | -1 | -1 | 1   |


Generators can be described by generator equations.  This design has equation $I = ABC$.  Such generator equations come in handy for exploring the consequences of fractional factorial designs.  For example, since A multiplied by A elementwise will always be a vector of ones, we see that $AI = AABC$, and, simplifying, $A = BC$, which can be verified by looking at the sub-table.  A consequence of the fractional factorial design is that the main effect A is confounded with the two-way interaction BC.  In effect, this means that when the main effects model (without interaction) is fit to the data, the estimate of the main effect of A is actually an estimate of $A+BC$, the main effect plus the BC two-way interaction effect.

The price paid by fractional factorial designs is the confounding of effects.

The *resolution* of a fractional factorial design describes the way it contributes to confounding.  A design is called resolution R if no p-factor effect is confounded with any R-p-1 factor effect.  A design that is resolution 3 has no main effect confounded by another main effect, but main effects are confounded with two-way interactions.  A resolution 4 design has no main effect confounded with another main effect or a two-way interaction, but two-way effects may be confounded.  And, resolution 5 designs have main effects and two-way interactions free of confounding with other main effects and two-way interactions.

Of course, there is nothing stopping use from considering even smaller fractions of a full factorial experiment.  For example, we may generate a $2^{k-2}$ design---a one-quarter fraction---using two generators, say $P$ and $Q$, representing two effects.  The generating equations are $I=P=Q=PQ$.  for example, for a $2^{6-2}$ design we may choose the four-way interactions ABCE and BCDF as generators.  Then $I=ABCE=BCDF = AEDF$ and the resulting design is resolution 4.  Note the choices here are not arbitrary; for example, a bad choice would be $I = ABCD=BCDE$ because $ABCDBCDE = AE$ and, as a result, we have confounded main effects A and E!  

### An example fractional factorial experiment

The following experiment comes from an industrial application of injection molding.  Poor process quality may be caused by several factors including mold temperature (A), screw speed (B), holding time (C), cycle time (D), gate size (E), and holding pressure (F).  A fractional factorial $2^{6-2}$ experiment is used based on the belief that only main effects and two-way interactions are likely to be present.  Four center point replicates are used to estimate error and test for model curvature.  After dropping insignificant effects, the final model contains only A, B, and AB.  F tests do not indicate model curvature or lack of fit.



```r
A <- c(-1,1,-1,1,-1,1,-1,1,-1,1,-1,1,-1,1,-1,1,0,0,0,0)
B <- c(-1,-1,1,1,-1,-1,1,1,-1,-1,1,1,-1,-1,1,1,0,0,0,0)
C <- c(-1,-1,-1,-1,1,1,1,1,-1,-1,-1,-1,1,1,1,1,0,0,0,0)
D <- c(-1,-1,-1,-1,-1,-1,-1,-1,1,1,1,1,1,1,1,1,0,0,0,0)
E <- A*B*C
F <- B*C*D
Y <- c(6,10,32,60,4,15,26,60,8,12,34,60,16,5,37,52,29,34,26,30)
data <- data.frame(Y,A,B,C,D,E,F)

fit <- aov(Y~A+B+A*B, data = data)
anova(fit)
```

```
## Analysis of Variance Table
## 
## Response: Y
##           Df Sum Sq Mean Sq F value    Pr(>F)    
## A          1  770.1   770.1  41.000 8.742e-06 ***
## B          1 5076.6  5076.6 270.288 1.917e-11 ***
## A:B        1  564.1   564.1  30.032 5.037e-05 ***
## Residuals 16  300.5    18.8                      
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```

```r
# test for curvature
mean.center <- mean(Y[17:20])
SS.center <- sum((Y[17:20] - mean.center)^2)
MS.center <- SS.center / 3
mean.factorial <- mean(Y[1:16])
SS.factorial <- 16*4*((mean.center - mean.factorial)^2)/20
F <- SS.factorial / MS.center
1-pf(F,1,3) # rejection is bad, indicates curvature
```

```
## [1] 0.2786071
```

```r
pure.error <- MS.center
pure.error
```

```
## [1] 10.91667
```

```r
# Test for lack of Fit
LoF <- sum(fit$residuals^2) -SS.factorial- SS.center
F.LoF <- (LoF/(15-3))/MS.center
1-pf(F.LoF,12,3) # rejection is bad, indicates model does not fit
```

```
## [1] 0.3276994
```











