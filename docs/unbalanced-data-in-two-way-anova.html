<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 10 Unbalanced data in Two-Way ANOVA | Applied Linear Models</title>
  <meta name="description" content="These are a collection of notes related to STAT 500 at Iowa State University. This is a work in progress." />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 10 Unbalanced data in Two-Way ANOVA | Applied Linear Models" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="These are a collection of notes related to STAT 500 at Iowa State University. This is a work in progress." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 10 Unbalanced data in Two-Way ANOVA | Applied Linear Models" />
  
  <meta name="twitter:description" content="These are a collection of notes related to STAT 500 at Iowa State University. This is a work in progress." />
  

<meta name="author" content="Nick Syring" />


<meta name="date" content="2022-10-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="two-way-anova.html"/>
<link rel="next" href="missing-cells-in-two-way-anova.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Applied Linear Models</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About</a></li>
<li class="chapter" data-level="2" data-path="data-analysis-and-statistical-inference.html"><a href="data-analysis-and-statistical-inference.html"><i class="fa fa-check"></i><b>2</b> Data Analysis and Statistical Inference</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-analysis-and-statistical-inference.html"><a href="data-analysis-and-statistical-inference.html#data-experiments-and-studies"><i class="fa fa-check"></i><b>2.1</b> Data, Experiments, and Studies</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="data-analysis-and-statistical-inference.html"><a href="data-analysis-and-statistical-inference.html#james-linds-scurvy-trial"><i class="fa fa-check"></i><b>2.1.1</b> James Lind’s Scurvy Trial</a></li>
<li class="chapter" data-level="2.1.2" data-path="data-analysis-and-statistical-inference.html"><a href="data-analysis-and-statistical-inference.html#framingham-heart-study"><i class="fa fa-check"></i><b>2.1.2</b> Framingham Heart Study</a></li>
<li class="chapter" data-level="2.1.3" data-path="data-analysis-and-statistical-inference.html"><a href="data-analysis-and-statistical-inference.html#harris-bank-sex-pay-study"><i class="fa fa-check"></i><b>2.1.3</b> Harris Bank Sex Pay Study</a></li>
<li class="chapter" data-level="2.1.4" data-path="data-analysis-and-statistical-inference.html"><a href="data-analysis-and-statistical-inference.html#large-aggregated-data-sets"><i class="fa fa-check"></i><b>2.1.4</b> Large, Aggregated Data Sets</a></li>
<li class="chapter" data-level="2.1.5" data-path="data-analysis-and-statistical-inference.html"><a href="data-analysis-and-statistical-inference.html#study-concepts"><i class="fa fa-check"></i><b>2.1.5</b> Study Concepts</a></li>
<li class="chapter" data-level="2.1.6" data-path="data-analysis-and-statistical-inference.html"><a href="data-analysis-and-statistical-inference.html#randomization-control-and-causation"><i class="fa fa-check"></i><b>2.1.6</b> Randomization, control, and causation</a></li>
<li class="chapter" data-level="2.1.7" data-path="data-analysis-and-statistical-inference.html"><a href="data-analysis-and-statistical-inference.html#populations-and-scope-of-inference"><i class="fa fa-check"></i><b>2.1.7</b> Populations and scope of inference</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="data-analysis-and-statistical-inference.html"><a href="data-analysis-and-statistical-inference.html#data-summaries"><i class="fa fa-check"></i><b>2.2</b> Data Summaries</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="data-analysis-and-statistical-inference.html"><a href="data-analysis-and-statistical-inference.html#numerical-summaries"><i class="fa fa-check"></i><b>2.2.1</b> Numerical Summaries</a></li>
<li class="chapter" data-level="2.2.2" data-path="data-analysis-and-statistical-inference.html"><a href="data-analysis-and-statistical-inference.html#visual-summaries"><i class="fa fa-check"></i><b>2.2.2</b> Visual Summaries</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="data-analysis-and-statistical-inference.html"><a href="data-analysis-and-statistical-inference.html#statistical-inference"><i class="fa fa-check"></i><b>2.3</b> Statistical Inference</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="introduction-to-linear-models.html"><a href="introduction-to-linear-models.html"><i class="fa fa-check"></i><b>3</b> Introduction to Linear Models</a>
<ul>
<li class="chapter" data-level="3.1" data-path="introduction-to-linear-models.html"><a href="introduction-to-linear-models.html#defining-the-linear-model"><i class="fa fa-check"></i><b>3.1</b> Defining the linear model</a></li>
<li class="chapter" data-level="3.2" data-path="introduction-to-linear-models.html"><a href="introduction-to-linear-models.html#gauss-markov-model-for-one-sample"><i class="fa fa-check"></i><b>3.2</b> Gauss-Markov model for one sample</a></li>
<li class="chapter" data-level="3.3" data-path="introduction-to-linear-models.html"><a href="introduction-to-linear-models.html#gauss-markov-model-for-comparing-two-samples"><i class="fa fa-check"></i><b>3.3</b> Gauss-Markov model for comparing two samples</a></li>
<li class="chapter" data-level="3.4" data-path="introduction-to-linear-models.html"><a href="introduction-to-linear-models.html#pairwise-testing-and-bonferroni-correction"><i class="fa fa-check"></i><b>3.4</b> Pairwise testing and Bonferroni correction</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="introduction-to-linear-models.html"><a href="introduction-to-linear-models.html#example-co2-uptake-in-echinochloa-crus-galli"><i class="fa fa-check"></i><b>3.4.1</b> Example: Co2 uptake in Echinochloa crus-galli</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="introduction-to-linear-models.html"><a href="introduction-to-linear-models.html#linear-models-for-more-than-two-treatments-populations"><i class="fa fa-check"></i><b>3.5</b> Linear Models for more than two treatments (populations)</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="randomization-and-permutation-testing.html"><a href="randomization-and-permutation-testing.html"><i class="fa fa-check"></i><b>4</b> Randomization and Permutation Testing</a>
<ul>
<li class="chapter" data-level="4.1" data-path="randomization-and-permutation-testing.html"><a href="randomization-and-permutation-testing.html#setup"><i class="fa fa-check"></i><b>4.1</b> Setup</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="randomization-and-permutation-testing.html"><a href="randomization-and-permutation-testing.html#example-1-the-harris-bank-sex-pay-study"><i class="fa fa-check"></i><b>4.1.1</b> Example 1: The Harris Bank Sex Pay Study</a></li>
<li class="chapter" data-level="4.1.2" data-path="randomization-and-permutation-testing.html"><a href="randomization-and-permutation-testing.html#difference-in-mean-salaries-between-genders"><i class="fa fa-check"></i><b>4.1.2</b> Difference in mean salaries between genders</a></li>
<li class="chapter" data-level="4.1.3" data-path="randomization-and-permutation-testing.html"><a href="randomization-and-permutation-testing.html#randomization-test-for-treatment-significance"><i class="fa fa-check"></i><b>4.1.3</b> Randomization test for treatment significance</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="alternatives-for-non-normal-responses.html"><a href="alternatives-for-non-normal-responses.html"><i class="fa fa-check"></i><b>5</b> Alternatives for Non-Normal Responses</a>
<ul>
<li class="chapter" data-level="5.1" data-path="alternatives-for-non-normal-responses.html"><a href="alternatives-for-non-normal-responses.html#transformations"><i class="fa fa-check"></i><b>5.1</b> Transformations</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="alternatives-for-non-normal-responses.html"><a href="alternatives-for-non-normal-responses.html#example-cloud-seeding-for-rainfall"><i class="fa fa-check"></i><b>5.1.1</b> Example: Cloud Seeding for Rainfall</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="alternatives-for-non-normal-responses.html"><a href="alternatives-for-non-normal-responses.html#rank-sum-test"><i class="fa fa-check"></i><b>5.2</b> Rank-Sum Test</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="alternatives-for-non-normal-responses.html"><a href="alternatives-for-non-normal-responses.html#example-ratio-measurements"><i class="fa fa-check"></i><b>5.2.1</b> Example: ratio measurements</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="alternatives-for-non-normal-responses.html"><a href="alternatives-for-non-normal-responses.html#signed-rank-test"><i class="fa fa-check"></i><b>5.3</b> Signed-rank test</a></li>
<li class="chapter" data-level="5.4" data-path="alternatives-for-non-normal-responses.html"><a href="alternatives-for-non-normal-responses.html#bootstrap"><i class="fa fa-check"></i><b>5.4</b> Bootstrap</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="alternatives-for-non-normal-responses.html"><a href="alternatives-for-non-normal-responses.html#intro-to-the-bootstrap"><i class="fa fa-check"></i><b>5.4.1</b> Intro to the bootstrap</a></li>
<li class="chapter" data-level="5.4.2" data-path="alternatives-for-non-normal-responses.html"><a href="alternatives-for-non-normal-responses.html#bootstrap-confidence-intervals"><i class="fa fa-check"></i><b>5.4.2</b> Bootstrap Confidence Intervals</a></li>
<li class="chapter" data-level="5.4.3" data-path="alternatives-for-non-normal-responses.html"><a href="alternatives-for-non-normal-responses.html#bootstrapping-linear-models"><i class="fa fa-check"></i><b>5.4.3</b> Bootstrapping linear models</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="one-way-anova.html"><a href="one-way-anova.html"><i class="fa fa-check"></i><b>6</b> One Way ANOVA</a>
<ul>
<li class="chapter" data-level="6.1" data-path="one-way-anova.html"><a href="one-way-anova.html#the-gauss-markov-model-for-comparing-i-populations"><i class="fa fa-check"></i><b>6.1</b> The Gauss-Markov Model for comparing I populations</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="one-way-anova.html"><a href="one-way-anova.html#example-donuts-effects-model"><i class="fa fa-check"></i><b>6.1.1</b> Example: Donuts effects model</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="one-way-anova.html"><a href="one-way-anova.html#testing-equality-of-means"><i class="fa fa-check"></i><b>6.2</b> Testing equality of means</a></li>
<li class="chapter" data-level="6.3" data-path="one-way-anova.html"><a href="one-way-anova.html#follow-up-testing"><i class="fa fa-check"></i><b>6.3</b> Follow-up testing</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="one-way-anova.html"><a href="one-way-anova.html#donuts-example"><i class="fa fa-check"></i><b>6.3.1</b> Donuts example</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="one-way-anova.html"><a href="one-way-anova.html#inference-for-particular-contrasts"><i class="fa fa-check"></i><b>6.4</b> Inference for particular contrasts</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="one-way-anova.html"><a href="one-way-anova.html#donuts-example-1"><i class="fa fa-check"></i><b>6.4.1</b> Donuts Example</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="one-way-anova.html"><a href="one-way-anova.html#checking-assumptions-in-one-way-anova"><i class="fa fa-check"></i><b>6.5</b> Checking Assumptions in one-way ANOVA</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="one-way-anova.html"><a href="one-way-anova.html#example-cehcking-assumptions-for-donuts-experiment"><i class="fa fa-check"></i><b>6.5.1</b> Example: Cehcking assumptions for donuts experiment</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="randomized-complete-block-design.html"><a href="randomized-complete-block-design.html"><i class="fa fa-check"></i><b>7</b> Randomized Complete Block Design</a>
<ul>
<li class="chapter" data-level="7.1" data-path="randomized-complete-block-design.html"><a href="randomized-complete-block-design.html#paired-experiments-as-blocking"><i class="fa fa-check"></i><b>7.1</b> Paired experiments as blocking</a></li>
<li class="chapter" data-level="7.2" data-path="randomized-complete-block-design.html"><a href="randomized-complete-block-design.html#randomized-complete-block-designs"><i class="fa fa-check"></i><b>7.2</b> Randomized Complete Block Designs</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="randomized-complete-block-design.html"><a href="randomized-complete-block-design.html#notation"><i class="fa fa-check"></i><b>7.2.1</b> Notation</a></li>
<li class="chapter" data-level="7.2.2" data-path="randomized-complete-block-design.html"><a href="randomized-complete-block-design.html#example-penicillin-manufacturing"><i class="fa fa-check"></i><b>7.2.2</b> Example: Penicillin Manufacturing</a></li>
<li class="chapter" data-level="7.2.3" data-path="randomized-complete-block-design.html"><a href="randomized-complete-block-design.html#sums-of-squares-and-f-tests-in-rcbd"><i class="fa fa-check"></i><b>7.2.3</b> Sums of squares and F tests in RCBD</a></li>
<li class="chapter" data-level="7.2.4" data-path="randomized-complete-block-design.html"><a href="randomized-complete-block-design.html#example-significance-of-process-in-penicillin-experiment"><i class="fa fa-check"></i><b>7.2.4</b> Example: Significance of Process in Penicillin experiment</a></li>
<li class="chapter" data-level="7.2.5" data-path="randomized-complete-block-design.html"><a href="randomized-complete-block-design.html#follow-up-comparisons-and-contrasts"><i class="fa fa-check"></i><b>7.2.5</b> Follow-up comparisons and contrasts</a></li>
<li class="chapter" data-level="7.2.6" data-path="randomized-complete-block-design.html"><a href="randomized-complete-block-design.html#example-tukey-contrasts-and-scheffe-for-penicillin-experiment"><i class="fa fa-check"></i><b>7.2.6</b> Example: Tukey, contrasts, and Scheffe for penicillin experiment</a></li>
<li class="chapter" data-level="7.2.7" data-path="randomized-complete-block-design.html"><a href="randomized-complete-block-design.html#relative-efficiency-of-blocking-vs.-crd"><i class="fa fa-check"></i><b>7.2.7</b> Relative efficiency of Blocking (vs. CRD)</a></li>
<li class="chapter" data-level="7.2.8" data-path="randomized-complete-block-design.html"><a href="randomized-complete-block-design.html#example-re-of-blocking-in-penicillin-experiment"><i class="fa fa-check"></i><b>7.2.8</b> Example: RE of blocking in penicillin experiment</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="latin-squares-for-two-blocking-variables.html"><a href="latin-squares-for-two-blocking-variables.html"><i class="fa fa-check"></i><b>8</b> Latin Squares for two blocking variables</a>
<ul>
<li class="chapter" data-level="8.1" data-path="latin-squares-for-two-blocking-variables.html"><a href="latin-squares-for-two-blocking-variables.html#designs-for-multiple-blocks"><i class="fa fa-check"></i><b>8.1</b> Designs for multiple blocks</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="latin-squares-for-two-blocking-variables.html"><a href="latin-squares-for-two-blocking-variables.html#example-mpg-experiment"><i class="fa fa-check"></i><b>8.1.1</b> Example: MPG experiment</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="latin-squares-for-two-blocking-variables.html"><a href="latin-squares-for-two-blocking-variables.html#model-notation"><i class="fa fa-check"></i><b>8.2</b> Model notation</a></li>
<li class="chapter" data-level="8.3" data-path="latin-squares-for-two-blocking-variables.html"><a href="latin-squares-for-two-blocking-variables.html#sums-of-squares-and-test-for-treatment-effects"><i class="fa fa-check"></i><b>8.3</b> Sums of squares and test for treatment effects</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="latin-squares-for-two-blocking-variables.html"><a href="latin-squares-for-two-blocking-variables.html#example-mpg-experiment-1"><i class="fa fa-check"></i><b>8.3.1</b> Example: MPG experiment</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="latin-squares-for-two-blocking-variables.html"><a href="latin-squares-for-two-blocking-variables.html#relative-efficiency-of-blocking"><i class="fa fa-check"></i><b>8.4</b> Relative efficiency of blocking</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="latin-squares-for-two-blocking-variables.html"><a href="latin-squares-for-two-blocking-variables.html#example-re-ignoring-driver-blocks"><i class="fa fa-check"></i><b>8.4.1</b> Example: RE ignoring driver blocks</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="two-way-anova.html"><a href="two-way-anova.html"><i class="fa fa-check"></i><b>9</b> Two-Way ANOVA</a>
<ul>
<li class="chapter" data-level="9.1" data-path="two-way-anova.html"><a href="two-way-anova.html#the-model"><i class="fa fa-check"></i><b>9.1</b> The Model</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="two-way-anova.html"><a href="two-way-anova.html#example-protein-chemistry"><i class="fa fa-check"></i><b>9.1.1</b> Example: protein chemistry</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="two-way-anova.html"><a href="two-way-anova.html#tests-for-interaction-and-main-effects"><i class="fa fa-check"></i><b>9.2</b> Tests for interaction and main effects</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="two-way-anova.html"><a href="two-way-anova.html#example-protein-and-dietary-metals"><i class="fa fa-check"></i><b>9.2.1</b> Example: Protein and dietary metals</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="unbalanced-data-in-two-way-anova.html"><a href="unbalanced-data-in-two-way-anova.html"><i class="fa fa-check"></i><b>10</b> Unbalanced data in Two-Way ANOVA</a>
<ul>
<li class="chapter" data-level="10.1" data-path="unbalanced-data-in-two-way-anova.html"><a href="unbalanced-data-in-two-way-anova.html#raw-and-least-squares-means"><i class="fa fa-check"></i><b>10.1</b> Raw and Least-Squares Means</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="unbalanced-data-in-two-way-anova.html"><a href="unbalanced-data-in-two-way-anova.html#example-turbine-data"><i class="fa fa-check"></i><b>10.1.1</b> Example: Turbine data</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="unbalanced-data-in-two-way-anova.html"><a href="unbalanced-data-in-two-way-anova.html#partial-f-tests-and-type-iii-ss"><i class="fa fa-check"></i><b>10.2</b> Partial F tests and Type III SS</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="unbalanced-data-in-two-way-anova.html"><a href="unbalanced-data-in-two-way-anova.html#example-turbine-data-tests"><i class="fa fa-check"></i><b>10.2.1</b> Example: Turbine Data tests</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="unbalanced-data-in-two-way-anova.html"><a href="unbalanced-data-in-two-way-anova.html#follow-up-tests"><i class="fa fa-check"></i><b>10.3</b> Follow-up tests</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="unbalanced-data-in-two-way-anova.html"><a href="unbalanced-data-in-two-way-anova.html#example-turbine-data-tukey-corrected-pairwise-comparisons"><i class="fa fa-check"></i><b>10.3.1</b> Example: Turbine data Tukey-corrected pairwise comparisons</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="unbalanced-data-in-two-way-anova.html"><a href="unbalanced-data-in-two-way-anova.html#unbalanced-data-and-simpsons-paradox"><i class="fa fa-check"></i><b>10.4</b> Unbalanced data and Simpson’s Paradox</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="missing-cells-in-two-way-anova.html"><a href="missing-cells-in-two-way-anova.html"><i class="fa fa-check"></i><b>11</b> Missing Cells in Two-Way ANOVA</a>
<ul>
<li class="chapter" data-level="11.1" data-path="missing-cells-in-two-way-anova.html"><a href="missing-cells-in-two-way-anova.html#anova-with-missing-at-random-cell"><i class="fa fa-check"></i><b>11.1</b> ANOVA with missing “at random” cell</a></li>
<li class="chapter" data-level="11.2" data-path="missing-cells-in-two-way-anova.html"><a href="missing-cells-in-two-way-anova.html#do-any-of-the-treatments-matter"><i class="fa fa-check"></i><b>11.2</b> Do any of the treatments matter?</a></li>
<li class="chapter" data-level="11.3" data-path="missing-cells-in-two-way-anova.html"><a href="missing-cells-in-two-way-anova.html#fit-a-linear-model-with-additional-constraints"><i class="fa fa-check"></i><b>11.3</b> Fit a linear model with additional constraints</a></li>
<li class="chapter" data-level="11.4" data-path="missing-cells-in-two-way-anova.html"><a href="missing-cells-in-two-way-anova.html#general-linear-test-for-interaction"><i class="fa fa-check"></i><b>11.4</b> General Linear Test for interaction</a></li>
<li class="chapter" data-level="11.5" data-path="missing-cells-in-two-way-anova.html"><a href="missing-cells-in-two-way-anova.html#partial-analysis-for-interaction"><i class="fa fa-check"></i><b>11.5</b> Partial analysis for interaction</a></li>
<li class="chapter" data-level="11.6" data-path="missing-cells-in-two-way-anova.html"><a href="missing-cells-in-two-way-anova.html#tests-for-main-effects-in-the-partial-table"><i class="fa fa-check"></i><b>11.6</b> Tests for main effects in the partial table</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="strategy-for-analysis-in-two-factor-models.html"><a href="strategy-for-analysis-in-two-factor-models.html"><i class="fa fa-check"></i><b>12</b> Strategy for Analysis in Two-Factor models</a>
<ul>
<li class="chapter" data-level="12.1" data-path="strategy-for-analysis-in-two-factor-models.html"><a href="strategy-for-analysis-in-two-factor-models.html#unbalanced-two-factor-experiment-chick-weight"><i class="fa fa-check"></i><b>12.1</b> Unbalanced Two-Factor Experiment: Chick Weight</a></li>
<li class="chapter" data-level="12.2" data-path="strategy-for-analysis-in-two-factor-models.html"><a href="strategy-for-analysis-in-two-factor-models.html#example-observational-study-on-growth-hormone-deficient-children-with-empty-cell"><i class="fa fa-check"></i><b>12.2</b> Example: observational study on growth-hormone deficient children with empty cell</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="strategy-for-analysis-in-two-factor-models.html"><a href="strategy-for-analysis-in-two-factor-models.html#linear-model-analysis-with-extra-constraint"><i class="fa fa-check"></i><b>12.2.1</b> Linear Model analysis with extra constraint</a></li>
<li class="chapter" data-level="12.2.2" data-path="strategy-for-analysis-in-two-factor-models.html"><a href="strategy-for-analysis-in-two-factor-models.html#partial-table-analysis"><i class="fa fa-check"></i><b>12.2.2</b> Partial Table analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="k-factorial-experiments.html"><a href="k-factorial-experiments.html"><i class="fa fa-check"></i><b>13</b> <span class="math inline">\(2^k\)</span> Factorial Experiments</a>
<ul>
<li class="chapter" data-level="13.1" data-path="k-factorial-experiments.html"><a href="k-factorial-experiments.html#the-model-1"><i class="fa fa-check"></i><b>13.1</b> The Model</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="k-factorial-experiments.html"><a href="k-factorial-experiments.html#example-stress-test-study"><i class="fa fa-check"></i><b>13.1.1</b> Example: Stress Test Study</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="k-factorial-experiments.html"><a href="k-factorial-experiments.html#unreplicated-factorial-experiments"><i class="fa fa-check"></i><b>13.2</b> Unreplicated Factorial Experiments</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="k-factorial-experiments.html"><a href="k-factorial-experiments.html#example-granola-bar-experiment"><i class="fa fa-check"></i><b>13.2.1</b> Example: Granola bar experiment</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Applied Linear Models</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="unbalanced-data-in-two-way-anova" class="section level1 hasAnchor" number="10">
<h1><span class="header-section-number">Chapter 10</span> Unbalanced data in Two-Way ANOVA<a href="unbalanced-data-in-two-way-anova.html#unbalanced-data-in-two-way-anova" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>What happens if <span class="math inline">\(n_{ij}\)</span> is not the same over crossed levels of the treatment factors? And, worse, what if some combination has zero replicates?!?<br><br></p>
<p>This is very common for two reasons: in observational studies researchers have less control over the number of subjects with certain levels of factors. Even when these are controlled through sampling or fixed in experimental studies there will be individuals that are lost/missing for some reason, and this ruins balance. <br><br></p>
<p>What goes wrong and what still works? (some of these things we haven’t yet defined)<br>
- Comparisons using contrasts - still work!
- Partial F tests in linear model - still work!
- least-squares means - still work!
- Sums of squares (you guessed it) - fails miserably!
<br><br></p>
<p>Throughout we’ll assume missing observations/lack of balance occurs at random, that is, does not have anything to do with treatments. If, however, a treatment level causes loss of observations, our analysis will have problems. You can imagine a treatment that causes side-effects in humans may cause “loss to follow-up” when taking before-after measures, because people will dislike the treatment and drop out of the study. So, independence of unbalance and treatment is not always a given.</p>
<div id="raw-and-least-squares-means" class="section level2 hasAnchor" number="10.1">
<h2><span class="header-section-number">10.1</span> Raw and Least-Squares Means<a href="unbalanced-data-in-two-way-anova.html#raw-and-least-squares-means" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Consider a two-way ANOVA where factors A and B each have 2 levels, simplest possible setup. Given observations:</p>
<table>
<thead>
<tr class="header">
<th></th>
<th></th>
<th>Cell Means (Sample Sizes)</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td></td>
<td>B</td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>1</td>
<td>2</td>
</tr>
<tr class="odd">
<td>A</td>
<td>1</td>
<td>4.90(10)</td>
<td>2.79(4)</td>
</tr>
<tr class="even">
<td></td>
<td>2</td>
<td>8.14(2)</td>
<td>6.00(4)</td>
</tr>
</tbody>
</table>
<p>When the sample sizes were all equal (balanced) sample means were apples-to-apples. Now, not so much. We can define the “raw sample means” (sample-size weighted averages) by <span class="math inline">\(\overline Y_{1\cdot\cdot} = 4.30= \frac{1}{14}(10\times 4.9 + 4\times 2.79)\)</span>. The raw means are misleading if the other factor has an effect, because B at level 1 is more represented in the raw mean average than B at level 2. The difference of raw means <span class="math inline">\(\overline Y_{1\cdot\cdot} - \overline Y_{2\cdot\cdot}\)</span> also contains an effect from B, which is hidden/disguised when we sum over levels of B. The raw means for factor A are defined <span class="math inline">\(\mu_{i\cdot}^R = [\sum_{j}n_{ij}]^{-1}\sum_j n_{ij}\mu_{ij}\)</span>.<br><br></p>
<p>The “least-squares means” on the other hand, average the cell means without regard for sample size: mean of level 1 of A is <span class="math inline">\((2.79+4.9)/2 = 3.85\)</span>. The LS means for factor A are defined <span class="math inline">\(\mu_{i\cdot} = \sum_{j} \mu_{ij}/b\)</span> where <span class="math inline">\(b\)</span> is the number of levels of B. <br><br></p>
<p>When the experiment is balanced, these are equal.<br><br></p>
<p>The estimators of the raw means for factor A are simply the raw sample means <span class="math inline">\(\hat\mu_{i\cdot}^{R} = [\sum_{j}n_{ij}]^{-1}\sum_j n_{ij}\overline Y_{ij}\)</span>. These have standard error
<span class="math display">\[\text{s.e.}(\hat\mu_{i\cdot}^{R})=\sigma\left[\sum_{j}n_{ij}\right]^{-1/2}.\]</span>
The estimated LS means have standard error
<span class="math display">\[\text{s.e.}(\hat\mu_{i\cdot})=\sigma\sqrt{b^{-2}\sum_j n_{ij}^{-1}}.\]</span>
<br><br></p>
<p>“Simple effects” compare two levels of one factor at a fixed level of another factor. Differences of LS means are unweighted averages of simple effects:
<span class="math display">\[\sum_j(\mu_{ij} - \mu_{i&#39;j})/b\]</span></p>
<div id="example-turbine-data" class="section level3 hasAnchor" number="10.1.1">
<h3><span class="header-section-number">10.1.1</span> Example: Turbine data<a href="unbalanced-data-in-two-way-anova.html#example-turbine-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The following data describes characteristics of turbine jet engines. Turbine engines feature many spinning blades. Both the position and rate of revolutions of the moving blades affect the behavior of the outflow of air generated by the engines. The Strouhal number is one quantity that characterizes the oscillations of this flow of air. In the following data the Strouhal number is the response variable, and both rate and position of turbine blades are treatment factors.</p>
<a href="data:text/csv;base64,c3Ryb3VoYWwscG9zaXRpb24scmF0ZQ0KMjYwMTYuNjUsLTEsMA0KMjgyNTQuODQsLTEsMA0KMjc0MTMuNDUsLTEsMA0KMjg1NTYuNCwtMSwwDQoyNjAyOS41MiwxLDANCjI4MjcwLjIsMSwwDQoyNzM3MC45OCwxLDANCjI4NTQyLjYyLDEsMA0KMzAzNTkuNywtMSwxDQozMzE5MS43NCwtMSwxDQozMTQ4Ny4xOSwtMSwxDQozMzExMS4wNywtMSwxDQozMDA2Ni4yNSwxLDENCjMyODY4Ljk1LDEsMQ0KMzE3NTcuNTYsMSwxDQozMzQzNy45NSwxLDENCjMyMTg5LjQzLC0xLDINCjMzNzgyLjMxLC0xLDINCjM0MDkwLjExLC0xLDINCjMxMDk4LjI3LC0xLDINCjMwOTk0LjU2LDEsMg0KMzEwMTMuMTksMSwyDQozNDg5Mi4xMywxLDINCjMzMTE2Ljk4LDEsMg0K" download="flow.csv">Download flow.csv</a>
<p>The turbine data is balanced, but we’ll remove a few rows to create imbalance, just for illustration.</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="unbalanced-data-in-two-way-anova.html#cb304-1" aria-hidden="true" tabindex="-1"></a>strouhal.df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&#39;flow.csv&#39;</span>)</span>
<span id="cb304-2"><a href="unbalanced-data-in-two-way-anova.html#cb304-2" aria-hidden="true" tabindex="-1"></a>strouhal.df</span></code></pre></div>
<pre><code>##    strouhal position rate
## 1  26016.65       -1    0
## 2  28254.84       -1    0
## 3  27413.45       -1    0
## 4  28556.40       -1    0
## 5  26029.52        1    0
## 6  28270.20        1    0
## 7  27370.98        1    0
## 8  28542.62        1    0
## 9  30359.70       -1    1
## 10 33191.74       -1    1
## 11 31487.19       -1    1
## 12 33111.07       -1    1
## 13 30066.25        1    1
## 14 32868.95        1    1
## 15 31757.56        1    1
## 16 33437.95        1    1
## 17 32189.43       -1    2
## 18 33782.31       -1    2
## 19 34090.11       -1    2
## 20 31098.27       -1    2
## 21 30994.56        1    2
## 22 31013.19        1    2
## 23 34892.13        1    2
## 24 33116.98        1    2</code></pre>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="unbalanced-data-in-two-way-anova.html#cb306-1" aria-hidden="true" tabindex="-1"></a>strouhal.df<span class="ot">&lt;-</span>strouhal.df[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">8</span>,<span class="dv">24</span>),]</span>
<span id="cb306-2"><a href="unbalanced-data-in-two-way-anova.html#cb306-2" aria-hidden="true" tabindex="-1"></a>strouhal.df</span></code></pre></div>
<pre><code>##    strouhal position rate
## 2  28254.84       -1    0
## 3  27413.45       -1    0
## 4  28556.40       -1    0
## 5  26029.52        1    0
## 6  28270.20        1    0
## 7  27370.98        1    0
## 9  30359.70       -1    1
## 10 33191.74       -1    1
## 11 31487.19       -1    1
## 12 33111.07       -1    1
## 13 30066.25        1    1
## 14 32868.95        1    1
## 15 31757.56        1    1
## 16 33437.95        1    1
## 17 32189.43       -1    2
## 18 33782.31       -1    2
## 19 34090.11       -1    2
## 20 31098.27       -1    2
## 21 30994.56        1    2
## 22 31013.19        1    2
## 23 34892.13        1    2</code></pre>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="unbalanced-data-in-two-way-anova.html#cb308-1" aria-hidden="true" tabindex="-1"></a>strouhal.df<span class="sc">$</span>position<span class="ot">&lt;-</span><span class="fu">as.factor</span>(strouhal.df<span class="sc">$</span>position)</span>
<span id="cb308-2"><a href="unbalanced-data-in-two-way-anova.html#cb308-2" aria-hidden="true" tabindex="-1"></a>strouhal.df<span class="sc">$</span>rate<span class="ot">&lt;-</span><span class="fu">as.factor</span>(strouhal.df<span class="sc">$</span>rate)</span></code></pre></div>
<p>Below are the crossed treatment mean responses, the LS means, and the raw means:</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="unbalanced-data-in-two-way-anova.html#cb309-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<pre><code>## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──
## ✔ ggplot2 3.3.6      ✔ purrr   0.3.4 
## ✔ tibble  3.1.8      ✔ dplyr   1.0.10
## ✔ tidyr   1.2.1      ✔ stringr 1.4.1 
## ✔ readr   2.1.2      ✔ forcats 0.5.2 
## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()</code></pre>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="unbalanced-data-in-two-way-anova.html#cb311-1" aria-hidden="true" tabindex="-1"></a>by_trt <span class="ot">&lt;-</span> <span class="fu">group_by</span>(strouhal.df, position, rate)</span>
<span id="cb311-2"><a href="unbalanced-data-in-two-way-anova.html#cb311-2" aria-hidden="true" tabindex="-1"></a>mean_resp <span class="ot">&lt;-</span> <span class="fu">summarise</span>(by_trt, <span class="at">trt_mean =</span> <span class="fu">mean</span>(strouhal))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;position&#39;. You can override using the
## `.groups` argument.</code></pre>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="unbalanced-data-in-two-way-anova.html#cb313-1" aria-hidden="true" tabindex="-1"></a>mean_resp</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
## # Groups:   position [2]
##   position rate  trt_mean
##   &lt;fct&gt;    &lt;fct&gt;    &lt;dbl&gt;
## 1 -1       0       28075.
## 2 -1       1       32037.
## 3 -1       2       32790.
## 4 1        0       27224.
## 5 1        1       32033.
## 6 1        2       32300.</code></pre>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="unbalanced-data-in-two-way-anova.html#cb315-1" aria-hidden="true" tabindex="-1"></a>mean_resp<span class="ot">&lt;-</span><span class="fu">as.matrix</span>(mean_resp[,<span class="dv">3</span>])</span>
<span id="cb315-2"><a href="unbalanced-data-in-two-way-anova.html#cb315-2" aria-hidden="true" tabindex="-1"></a>LS_mean_pos <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">mean</span>(mean_resp[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="dv">1</span>]), <span class="fu">mean</span>(mean_resp[<span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>,<span class="dv">1</span>]))</span>
<span id="cb315-3"><a href="unbalanced-data-in-two-way-anova.html#cb315-3" aria-hidden="true" tabindex="-1"></a>LS_mean_pos</span></code></pre></div>
<pre><code>## [1] 30967.45 30518.73</code></pre>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="unbalanced-data-in-two-way-anova.html#cb317-1" aria-hidden="true" tabindex="-1"></a>LS_mean_rate <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">mean</span>(mean_resp[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>),<span class="dv">1</span>]), <span class="fu">mean</span>(mean_resp[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>),<span class="dv">1</span>]), <span class="fu">mean</span>(mean_resp[<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">6</span>),<span class="dv">1</span>]))</span>
<span id="cb317-2"><a href="unbalanced-data-in-two-way-anova.html#cb317-2" aria-hidden="true" tabindex="-1"></a>LS_mean_rate</span></code></pre></div>
<pre><code>## [1] 27649.23 32035.05 32544.99</code></pre>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="unbalanced-data-in-two-way-anova.html#cb319-1" aria-hidden="true" tabindex="-1"></a>by_pos <span class="ot">&lt;-</span> <span class="fu">group_by</span>(strouhal.df, position)</span>
<span id="cb319-2"><a href="unbalanced-data-in-two-way-anova.html#cb319-2" aria-hidden="true" tabindex="-1"></a>raw_mean_pos <span class="ot">&lt;-</span> <span class="fu">summarise</span>(by_pos, <span class="at">trt_mean =</span> <span class="fu">mean</span>(strouhal))</span>
<span id="cb319-3"><a href="unbalanced-data-in-two-way-anova.html#cb319-3" aria-hidden="true" tabindex="-1"></a>raw_mean_pos</span></code></pre></div>
<pre><code>## # A tibble: 2 × 2
##   position trt_mean
##   &lt;fct&gt;       &lt;dbl&gt;
## 1 -1         31230.
## 2 1          30670.</code></pre>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="unbalanced-data-in-two-way-anova.html#cb321-1" aria-hidden="true" tabindex="-1"></a>by_rate <span class="ot">&lt;-</span> <span class="fu">group_by</span>(strouhal.df, rate)</span>
<span id="cb321-2"><a href="unbalanced-data-in-two-way-anova.html#cb321-2" aria-hidden="true" tabindex="-1"></a>raw_mean_rate <span class="ot">&lt;-</span> <span class="fu">summarise</span>(by_rate, <span class="at">trt_mean =</span> <span class="fu">mean</span>(strouhal))</span>
<span id="cb321-3"><a href="unbalanced-data-in-two-way-anova.html#cb321-3" aria-hidden="true" tabindex="-1"></a>raw_mean_rate</span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   rate  trt_mean
##   &lt;fct&gt;    &lt;dbl&gt;
## 1 0       27649.
## 2 1       32035.
## 3 2       32580</code></pre>
<p>It is also convenient to compute the LS means using built-in functions from the package emmeans:. The “emmean” stands for estimated marginal mean. These are calculated based on a model. If we use the two way model with interaction, then the emmeans are the LS means.</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="unbalanced-data-in-two-way-anova.html#cb323-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb323-2"><a href="unbalanced-data-in-two-way-anova.html#cb323-2" aria-hidden="true" tabindex="-1"></a><span class="fu">emmeans</span>(<span class="fu">lm</span>(strouhal<span class="sc">~</span>position<span class="sc">+</span>rate<span class="sc">+</span>position<span class="sc">*</span>rate, <span class="at">data =</span> strouhal.df), <span class="st">&#39;position&#39;</span>)</span></code></pre></div>
<pre><code>## NOTE: Results may be misleading due to involvement in interactions</code></pre>
<pre><code>##  position emmean  SE df lower.CL upper.CL
##  -1        30967 441 15    30028    31906
##  1         30519 462 15    29534    31504
## 
## Results are averaged over the levels of: rate 
## Confidence level used: 0.95</code></pre>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="unbalanced-data-in-two-way-anova.html#cb326-1" aria-hidden="true" tabindex="-1"></a><span class="fu">emmeans</span>(<span class="fu">lm</span>(strouhal<span class="sc">~</span>position<span class="sc">+</span>rate<span class="sc">+</span>position<span class="sc">*</span>rate, <span class="at">data =</span> strouhal.df), <span class="st">&#39;rate&#39;</span>)</span></code></pre></div>
<pre><code>## NOTE: Results may be misleading due to involvement in interactions</code></pre>
<pre><code>##  rate emmean  SE df lower.CL upper.CL
##  0     27649 591 15    26389    28909
##  1     32035 512 15    30944    33126
##  2     32545 553 15    31367    33723
## 
## Results are averaged over the levels of: position 
## Confidence level used: 0.95</code></pre>
<p>Next, lets compute CIs for contrasts of LS means. For example, consider comparing mean Strouhal values at rate level 0 versus rate level 1. The point estimate is
<span class="math display">\[\overline Y_{\cdot,0} - \overline Y_{\cdot,1}\]</span>
the sample LS mean at level zero of rate summed over position minus the sample LS mean at level one of rate summed over position. This difference of sample means has the following standard error:
<span class="math display">\[\begin{align*}
V(\overline Y_{\cdot,0} - \overline Y_{\cdot,1}) &amp; = V(\tfrac12(\overline Y_{-1,0} + \overline Y_{1,0}) -\tfrac12(\overline Y_{-1,1} + \overline Y_{1,1}))//
&amp; = \sigma^2\tfrac14 (1/3 + 1/3 + 1/4 + 1/4)
\end{align*}\]</span>
using the cell sample sizes calculated in R below.</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="unbalanced-data-in-two-way-anova.html#cb329-1" aria-hidden="true" tabindex="-1"></a>by_trt <span class="ot">&lt;-</span> <span class="fu">group_by</span>(strouhal.df, position, rate)</span>
<span id="cb329-2"><a href="unbalanced-data-in-two-way-anova.html#cb329-2" aria-hidden="true" tabindex="-1"></a>n_resp <span class="ot">&lt;-</span> <span class="fu">summarise</span>(by_trt, <span class="at">trt_mean =</span> <span class="fu">n</span>())</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;position&#39;. You can override using the
## `.groups` argument.</code></pre>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="unbalanced-data-in-two-way-anova.html#cb331-1" aria-hidden="true" tabindex="-1"></a>n_resp</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
## # Groups:   position [2]
##   position rate  trt_mean
##   &lt;fct&gt;    &lt;fct&gt;    &lt;int&gt;
## 1 -1       0            3
## 2 -1       1            4
## 3 -1       2            4
## 4 1        0            3
## 5 1        1            4
## 6 1        2            3</code></pre>
<p>Then, a CI for the difference in LS means is given by
<span class="math display">\[\left(\overline Y_{\cdot,0} - \overline Y_{\cdot,1} \pm t_{1-\alpha/2, n-p}\sqrt{MSE\tfrac14 (1/3 + 1/3 + 1/4 + 1/4) }\right)\]</span></p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="unbalanced-data-in-two-way-anova.html#cb333-1" aria-hidden="true" tabindex="-1"></a>my.lm <span class="ot">&lt;-</span> <span class="fu">summary</span>(<span class="fu">lm</span>(strouhal<span class="sc">~</span>position<span class="sc">+</span>rate<span class="sc">+</span>position<span class="sc">*</span>rate, <span class="at">data =</span> strouhal.df))</span>
<span id="cb333-2"><a href="unbalanced-data-in-two-way-anova.html#cb333-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb333-3"><a href="unbalanced-data-in-two-way-anova.html#cb333-3" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(LS_mean_rate[<span class="dv">1</span>] <span class="sc">-</span> LS_mean_rate[<span class="dv">2</span>] <span class="sc">-</span> <span class="fu">qt</span>(<span class="fl">0.975</span>, my.lm<span class="sc">$</span>df[<span class="dv">2</span>])<span class="sc">*</span>my.lm<span class="sc">$</span>sigma<span class="sc">*</span><span class="fu">sqrt</span>((<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>)<span class="sc">*</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>)), LS_mean_rate[<span class="dv">1</span>] <span class="sc">-</span> LS_mean_rate[<span class="dv">2</span>] <span class="sc">+</span> <span class="fu">qt</span>(<span class="fl">0.975</span>, my.lm<span class="sc">$</span>df[<span class="dv">2</span>])<span class="sc">*</span>my.lm<span class="sc">$</span>sigma<span class="sc">*</span><span class="fu">sqrt</span>((<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>)<span class="sc">*</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>)))</span></code></pre></div>
<pre><code>## [1] -6052.374 -2719.265</code></pre>
</div>
</div>
<div id="partial-f-tests-and-type-iii-ss" class="section level2 hasAnchor" number="10.2">
<h2><span class="header-section-number">10.2</span> Partial F tests and Type III SS<a href="unbalanced-data-in-two-way-anova.html#partial-f-tests-and-type-iii-ss" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To test for interaction and main effects in unbalanced, to-way ANOVA, we cannot use the same sums of squares formulas as before. These do not work for unbalanced data. Essentially, they result in comparisons of raw, rather than LS means. <br><br></p>
<p>Instead, we test for interaction and main effects using <em>partial F tests</em>. Think of the Gauss-Markov notation <span class="math inline">\(Y=X\beta+\epsilon\)</span>. A partial F test is used to test the hypothesis <span class="math inline">\(H_0:\text{a certain set of }\beta_j\text{ coefficients is zero}\)</span>. The set could be as small as one coefficient, or as large as all the coefficients except for the intercept. Under the null hypothesis, inclusion in the model of the covariates corresponding to these coefficients does not substantially change the predicted responses <span class="math inline">\(\hat Y\)</span>; and, as a result, does not substantially reduce the sum of squared residuals. Therefore, the intuitive test of this null hypothesis is a comparison of SSE under models including versus excluding the given set of covariates:</p>
<p><span class="math display">\[F = \frac{[SSE(\text{reduced model}) - SSE(\text{full model})]/\text{number of excluded coefficients}}{MSE(\text{full model})}\]</span></p>
<p>Under <span class="math inline">\(H_0\)</span> the test statistic <span class="math inline">\(F\)</span> has an <span class="math inline">\(F\)</span> distribution with numerator degrees of freedom equal to the number of excluded coefficients and denominator degrees of freedom equal to <span class="math inline">\(n-p\)</span> where the full model coefficient vector <span class="math inline">\(\beta\)</span> has dimension <span class="math inline">\(p\times 1\)</span>.
<br><br>
SAS, and certain R functions, will report <em>Type III sums of squares</em> for unbalanced experiments. These are simply defined by partial F tests. For example, the Type III SS for factor A in a two-way ANOVA with interaction is simply the difference in the sum of squared residuals for the full linear model corresponding to the two-way ANOVA versus the reduced linear model where the columns of <span class="math inline">\(X\)</span> corresponding to the factor A main effects have been removed. Therefore, tests based on Type III sums of squares are exactly partial F tests.</p>
<div id="example-turbine-data-tests" class="section level3 hasAnchor" number="10.2.1">
<h3><span class="header-section-number">10.2.1</span> Example: Turbine Data tests<a href="unbalanced-data-in-two-way-anova.html#example-turbine-data-tests" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We can perform partial F tests by fitting reduced and full linear models and comparing sums of squared residuals. The R package <em>car</em> will perform these tests automatically using the function <em>Anova</em>. The following code computes a tests for the main effect of rate, both “by hand” by fitting full and reduced models, and using the Anova function. Note the equivalence of F statistics.</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="unbalanced-data-in-two-way-anova.html#cb335-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span></code></pre></div>
<pre><code>## Loading required package: carData</code></pre>
<pre><code>## 
## Attaching package: &#39;car&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     recode</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     some</code></pre>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="unbalanced-data-in-two-way-anova.html#cb340-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(<span class="fu">lm</span>(strouhal<span class="sc">~</span>position <span class="sc">+</span> rate<span class="sc">+</span>position<span class="sc">*</span>rate, <span class="at">data =</span> strouhal.df), <span class="at">type =</span> <span class="st">&#39;III&#39;</span>)</span></code></pre></div>
<pre><code>## Anova Table (Type III tests)
## 
## Response: strouhal
##                   Sum Sq Df   F value    Pr(&gt;F)    
## (Intercept)   2364599469  1 1128.1201 1.564e-15 ***
## position         1087144  1    0.5187  0.482485    
## rate            42206544  2   10.0681  0.001689 ** 
## position:rate     631584  2    0.1507  0.861425    
## Residuals       31440793 15                        
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="unbalanced-data-in-two-way-anova.html#cb342-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(strouhal<span class="sc">~</span>position <span class="sc">+</span> rate<span class="sc">+</span>position<span class="sc">*</span>rate, <span class="at">data =</span> strouhal.df))</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = strouhal ~ position + rate + position * rate, data = strouhal.df)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -1966.4 -1194.0   147.4  1046.6  2592.2 
## 
## Coefficients:
##                 Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)      28074.9      835.9  33.587 1.56e-15 ***
## position1         -851.3     1182.1  -0.720 0.482485    
## rate1             3962.5     1105.8   3.584 0.002716 ** 
## rate2             4715.1     1105.8   4.264 0.000679 ***
## position1:rate1    846.6     1563.8   0.541 0.596202    
## position1:rate2    361.3     1618.7   0.223 0.826403    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1448 on 15 degrees of freedom
## Multiple R-squared:  0.7511, Adjusted R-squared:  0.6681 
## F-statistic: 9.053 on 5 and 15 DF,  p-value: 0.000396</code></pre>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="unbalanced-data-in-two-way-anova.html#cb344-1" aria-hidden="true" tabindex="-1"></a>full.model <span class="ot">&lt;-</span> <span class="fu">lm</span>(strouhal<span class="sc">~</span>position <span class="sc">+</span> rate<span class="sc">+</span>position<span class="sc">*</span>rate, <span class="at">data =</span> strouhal.df)</span>
<span id="cb344-2"><a href="unbalanced-data-in-two-way-anova.html#cb344-2" aria-hidden="true" tabindex="-1"></a>SSE.full <span class="ot">&lt;-</span> <span class="fu">sum</span>(full.model<span class="sc">$</span>residuals<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb344-3"><a href="unbalanced-data-in-two-way-anova.html#cb344-3" aria-hidden="true" tabindex="-1"></a>MSE <span class="ot">&lt;-</span> SSE.full<span class="sc">/</span>(<span class="fu">nrow</span>(strouhal.df)<span class="sc">-</span><span class="dv">6</span>)</span>
<span id="cb344-4"><a href="unbalanced-data-in-two-way-anova.html#cb344-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-5"><a href="unbalanced-data-in-two-way-anova.html#cb344-5" aria-hidden="true" tabindex="-1"></a>X.R <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(strouhal<span class="sc">~</span>position <span class="sc">+</span> rate<span class="sc">+</span>position<span class="sc">*</span>rate, <span class="at">data =</span> strouhal.df)</span>
<span id="cb344-6"><a href="unbalanced-data-in-two-way-anova.html#cb344-6" aria-hidden="true" tabindex="-1"></a>X.R <span class="ot">&lt;-</span> X.R[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>)]</span>
<span id="cb344-7"><a href="unbalanced-data-in-two-way-anova.html#cb344-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-8"><a href="unbalanced-data-in-two-way-anova.html#cb344-8" aria-hidden="true" tabindex="-1"></a>beta.hat.R <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">t</span>(X.R)<span class="sc">%*%</span>X.R)<span class="sc">%*%</span><span class="fu">t</span>(X.R)<span class="sc">%*%</span>strouhal.df<span class="sc">$</span>strouhal</span>
<span id="cb344-9"><a href="unbalanced-data-in-two-way-anova.html#cb344-9" aria-hidden="true" tabindex="-1"></a>pred.R <span class="ot">&lt;-</span> X.R<span class="sc">%*%</span>beta.hat.R</span>
<span id="cb344-10"><a href="unbalanced-data-in-two-way-anova.html#cb344-10" aria-hidden="true" tabindex="-1"></a>SSE.R <span class="ot">&lt;-</span> <span class="fu">sum</span>((strouhal.df<span class="sc">$</span>strouhal <span class="sc">-</span> pred.R)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb344-11"><a href="unbalanced-data-in-two-way-anova.html#cb344-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-12"><a href="unbalanced-data-in-two-way-anova.html#cb344-12" aria-hidden="true" tabindex="-1"></a>F <span class="ot">&lt;-</span> ((SSE.R <span class="sc">-</span> SSE.full)<span class="sc">/</span>(<span class="dv">2</span>)) <span class="sc">/</span> (SSE.full <span class="sc">/</span> (<span class="fu">nrow</span>(X.R)<span class="sc">-</span><span class="dv">6</span>))</span>
<span id="cb344-13"><a href="unbalanced-data-in-two-way-anova.html#cb344-13" aria-hidden="true" tabindex="-1"></a>F</span></code></pre></div>
<pre><code>## [1] 10.0681</code></pre>
</div>
</div>
<div id="follow-up-tests" class="section level2 hasAnchor" number="10.3">
<h2><span class="header-section-number">10.3</span> Follow-up tests<a href="unbalanced-data-in-two-way-anova.html#follow-up-tests" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>From the Anova output in the above example we see that the main effect for rate is significant. Since rate has 3 factors, it makes sense to perform Tukey-corrected pairwise comparisons to better understand which levels of rate drive the significance of the effect. <br><br></p>
<p>For balanced experiments we typically use the R function TukeyHSD, which takes an aov object as its argument. But, since aov objects are based on Type I SS (raw means) these pairwise comparisons are not the comparisons we want to make. Rather, we want to make pairwise comparisons of LS means. <br><br></p>
<p>We can compute these by hand , as we did above for uncorrected pairwise comparisons. The only difference is that we replace the Student’s <span class="math inline">\(t\)</span> quantile in the CI calculation by the upper <span class="math inline">\(1-\alpha\)</span> quantile of Tukey’s Studentized range distribution, multiplied by <span class="math inline">\(1/\sqrt{2}\)</span>.</p>
<div id="example-turbine-data-tukey-corrected-pairwise-comparisons" class="section level3 hasAnchor" number="10.3.1">
<h3><span class="header-section-number">10.3.1</span> Example: Turbine data Tukey-corrected pairwise comparisons<a href="unbalanced-data-in-two-way-anova.html#example-turbine-data-tukey-corrected-pairwise-comparisons" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="unbalanced-data-in-two-way-anova.html#cb346-1" aria-hidden="true" tabindex="-1"></a>n_resp</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
## # Groups:   position [2]
##   position rate  trt_mean
##   &lt;fct&gt;    &lt;fct&gt;    &lt;int&gt;
## 1 -1       0            3
## 2 -1       1            4
## 3 -1       2            4
## 4 1        0            3
## 5 1        1            4
## 6 1        2            3</code></pre>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="unbalanced-data-in-two-way-anova.html#cb348-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(LS_mean_rate[<span class="dv">1</span>] <span class="sc">-</span> LS_mean_rate[<span class="dv">2</span>] <span class="sc">-</span> <span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">qtukey</span>(<span class="fl">0.95</span>,<span class="dv">3</span>, my.lm<span class="sc">$</span>df[<span class="dv">2</span>])<span class="sc">*</span>my.lm<span class="sc">$</span>sigma<span class="sc">*</span><span class="fu">sqrt</span>((<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>)<span class="sc">*</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>)), LS_mean_rate[<span class="dv">1</span>] <span class="sc">-</span> LS_mean_rate[<span class="dv">2</span>] <span class="sc">+</span> <span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">qtukey</span>(<span class="fl">0.95</span>,<span class="dv">3</span>, my.lm<span class="sc">$</span>df[<span class="dv">2</span>])<span class="sc">*</span>my.lm<span class="sc">$</span>sigma<span class="sc">*</span><span class="fu">sqrt</span>((<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>)<span class="sc">*</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>)))</span></code></pre></div>
<pre><code>## [1] -6416.750 -2354.889</code></pre>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="unbalanced-data-in-two-way-anova.html#cb350-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">-</span><span class="fu">ptukey</span>(<span class="fu">abs</span>(LS_mean_rate[<span class="dv">1</span>] <span class="sc">-</span> LS_mean_rate[<span class="dv">2</span>])<span class="sc">/</span>(<span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span>my.lm<span class="sc">$</span>sigma<span class="sc">*</span><span class="fu">sqrt</span>((<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>)<span class="sc">*</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>))), <span class="dv">3</span>, my.lm<span class="sc">$</span>df[<span class="dv">2</span>])</span></code></pre></div>
<pre><code>## [1] 0.0001390661</code></pre>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="unbalanced-data-in-two-way-anova.html#cb352-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(LS_mean_rate[<span class="dv">1</span>] <span class="sc">-</span> LS_mean_rate[<span class="dv">3</span>] <span class="sc">-</span> <span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">qtukey</span>(<span class="fl">0.95</span>,<span class="dv">3</span>, my.lm<span class="sc">$</span>df[<span class="dv">2</span>])<span class="sc">*</span>my.lm<span class="sc">$</span>sigma<span class="sc">*</span><span class="fu">sqrt</span>((<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>)<span class="sc">*</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)), LS_mean_rate[<span class="dv">1</span>] <span class="sc">-</span> LS_mean_rate[<span class="dv">2</span>] <span class="sc">+</span> <span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">qtukey</span>(<span class="fl">0.95</span>,<span class="dv">3</span>, my.lm<span class="sc">$</span>df[<span class="dv">2</span>])<span class="sc">*</span>my.lm<span class="sc">$</span>sigma<span class="sc">*</span><span class="fu">sqrt</span>((<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>)<span class="sc">*</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)))</span></code></pre></div>
<pre><code>## [1] -6997.976 -2283.607</code></pre>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="unbalanced-data-in-two-way-anova.html#cb354-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">-</span><span class="fu">ptukey</span>(<span class="fu">abs</span>(LS_mean_rate[<span class="dv">1</span>] <span class="sc">-</span> LS_mean_rate[<span class="dv">3</span>])<span class="sc">/</span>(<span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span>my.lm<span class="sc">$</span>sigma<span class="sc">*</span><span class="fu">sqrt</span>((<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>)<span class="sc">*</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>))), <span class="dv">3</span>, my.lm<span class="sc">$</span>df[<span class="dv">2</span>])</span></code></pre></div>
<pre><code>## [1] 6.250909e-05</code></pre>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="unbalanced-data-in-two-way-anova.html#cb356-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(LS_mean_rate[<span class="dv">2</span>] <span class="sc">-</span> LS_mean_rate[<span class="dv">3</span>] <span class="sc">-</span> <span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">qtukey</span>(<span class="fl">0.95</span>,<span class="dv">3</span>, my.lm<span class="sc">$</span>df[<span class="dv">2</span>])<span class="sc">*</span>my.lm<span class="sc">$</span>sigma<span class="sc">*</span><span class="fu">sqrt</span>((<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>)<span class="sc">*</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)), LS_mean_rate[<span class="dv">1</span>] <span class="sc">-</span> LS_mean_rate[<span class="dv">2</span>] <span class="sc">+</span> <span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span><span class="fu">qtukey</span>(<span class="fl">0.95</span>,<span class="dv">3</span>, my.lm<span class="sc">$</span>df[<span class="dv">2</span>])<span class="sc">*</span>my.lm<span class="sc">$</span>sigma<span class="sc">*</span><span class="fu">sqrt</span>((<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>)<span class="sc">*</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)))</span></code></pre></div>
<pre><code>## [1] -2466.998 -2428.766</code></pre>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="unbalanced-data-in-two-way-anova.html#cb358-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">-</span><span class="fu">ptukey</span>(<span class="fu">abs</span>(LS_mean_rate[<span class="dv">2</span>] <span class="sc">-</span> LS_mean_rate[<span class="dv">3</span>])<span class="sc">/</span>(<span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span>my.lm<span class="sc">$</span>sigma<span class="sc">*</span><span class="fu">sqrt</span>((<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>)<span class="sc">*</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>))), <span class="dv">3</span>, my.lm<span class="sc">$</span>df[<span class="dv">2</span>])</span></code></pre></div>
<pre><code>## [1] 0.7802542</code></pre>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="unbalanced-data-in-two-way-anova.html#cb360-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb360-2"><a href="unbalanced-data-in-two-way-anova.html#cb360-2" aria-hidden="true" tabindex="-1"></a>em.strouhal<span class="ot">&lt;-</span><span class="fu">emmeans</span>(<span class="fu">lm</span>(strouhal<span class="sc">~</span>position <span class="sc">+</span> rate<span class="sc">+</span>position<span class="sc">*</span>rate, <span class="at">data =</span> strouhal.df), <span class="st">&quot;rate&quot;</span>)</span></code></pre></div>
<pre><code>## NOTE: Results may be misleading due to involvement in interactions</code></pre>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="unbalanced-data-in-two-way-anova.html#cb362-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(em.strouhal, <span class="at">adjust =</span> <span class="st">&#39;tukey&#39;</span>)</span></code></pre></div>
<pre><code>##  contrast      estimate  SE df t.ratio p.value
##  rate0 - rate1    -4386 782 15  -5.609  0.0001
##  rate0 - rate2    -4896 809 15  -6.049  0.0001
##  rate1 - rate2     -510 753 15  -0.677  0.7803
## 
## Results are averaged over the levels of: position 
## P value adjustment: tukey method for comparing a family of 3 estimates</code></pre>
</div>
</div>
<div id="unbalanced-data-and-simpsons-paradox" class="section level2 hasAnchor" number="10.4">
<h2><span class="header-section-number">10.4</span> Unbalanced data and Simpson’s Paradox<a href="unbalanced-data-in-two-way-anova.html#unbalanced-data-and-simpsons-paradox" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The following toy example of unbalanced data helps illustrate the difference between using raw and LS means. The LS mean response for A level 1 is larger (-0.3) than the LS mean response for A level 2 (-0.7). And, the mean response when A is level 1 is larger than when A is level 2 for every level of B. However, for raw means, the reverse is true (-1.975 vs. 0.225)! If we look at the data we see this is due to the fact more samples are observed for the levels of B when A is level 1 and the response is lowest (10) compared to when it is highest (5). Basically, the sampling is biased towards levels of B where the A level 1 response is low and the A level 2 response is high. The raw means are not capturing a real difference in effect of A; rather, they are capturing a difference in sample weighting. <br><br></p>
<p>This is an example of <strong>Simpson’s Paradox</strong> where the direction of an effect may change if effects are weighted by sample size.</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="unbalanced-data-in-two-way-anova.html#cb364-1" aria-hidden="true" tabindex="-1"></a>Y1 <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)<span class="sc">+</span><span class="fl">0.1</span></span>
<span id="cb364-2"><a href="unbalanced-data-in-two-way-anova.html#cb364-2" aria-hidden="true" tabindex="-1"></a>Y2 <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb364-3"><a href="unbalanced-data-in-two-way-anova.html#cb364-3" aria-hidden="true" tabindex="-1"></a>Y3 <span class="ot">&lt;-</span> <span class="fu">c</span>((<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)<span class="sc">-</span><span class="dv">10</span>,(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)<span class="sc">-</span><span class="dv">10</span>) </span>
<span id="cb364-4"><a href="unbalanced-data-in-two-way-anova.html#cb364-4" aria-hidden="true" tabindex="-1"></a>Y4 <span class="ot">&lt;-</span> <span class="fu">c</span>((<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb364-5"><a href="unbalanced-data-in-two-way-anova.html#cb364-5" aria-hidden="true" tabindex="-1"></a>Y5 <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)<span class="sc">-</span><span class="fl">0.1</span></span>
<span id="cb364-6"><a href="unbalanced-data-in-two-way-anova.html#cb364-6" aria-hidden="true" tabindex="-1"></a>Y6 <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)<span class="sc">-</span><span class="dv">11</span></span>
<span id="cb364-7"><a href="unbalanced-data-in-two-way-anova.html#cb364-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb364-8"><a href="unbalanced-data-in-two-way-anova.html#cb364-8" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">20</span>),<span class="fu">rep</span>(<span class="dv">2</span>,<span class="dv">20</span>))</span>
<span id="cb364-9"><a href="unbalanced-data-in-two-way-anova.html#cb364-9" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">5</span>),<span class="fu">rep</span>(<span class="dv">2</span>,<span class="dv">5</span>), <span class="fu">rep</span>(<span class="dv">3</span>,<span class="dv">10</span>),<span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">10</span>),<span class="fu">rep</span>(<span class="dv">2</span>,<span class="dv">5</span>), <span class="fu">rep</span>(<span class="dv">3</span>,<span class="dv">5</span>))</span>
<span id="cb364-10"><a href="unbalanced-data-in-two-way-anova.html#cb364-10" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="fu">c</span>(Y1,Y2,Y3,Y4,Y5,Y6)</span>
<span id="cb364-11"><a href="unbalanced-data-in-two-way-anova.html#cb364-11" aria-hidden="true" tabindex="-1"></a>data.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Y=</span>Y,<span class="at">A=</span><span class="fu">as.factor</span>(A),<span class="at">B=</span><span class="fu">as.factor</span>(B))</span>
<span id="cb364-12"><a href="unbalanced-data-in-two-way-anova.html#cb364-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb364-13"><a href="unbalanced-data-in-two-way-anova.html#cb364-13" aria-hidden="true" tabindex="-1"></a>by_trt <span class="ot">&lt;-</span> <span class="fu">group_by</span>(data.df, A,B)</span>
<span id="cb364-14"><a href="unbalanced-data-in-two-way-anova.html#cb364-14" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(by_trt, <span class="at">trt_mean =</span> <span class="fu">mean</span>(Y))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;A&#39;. You can override using the `.groups`
## argument.</code></pre>
<pre><code>## # A tibble: 6 × 3
## # Groups:   A [2]
##   A     B     trt_mean
##   &lt;fct&gt; &lt;fct&gt;    &lt;dbl&gt;
## 1 1     1          3.1
## 2 1     2          3  
## 3 1     3         -7  
## 4 2     1          3  
## 5 2     2          2.9
## 6 2     3         -8</code></pre>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="unbalanced-data-in-two-way-anova.html#cb367-1" aria-hidden="true" tabindex="-1"></a><span class="fu">emmeans</span>(<span class="fu">lm</span>(Y<span class="sc">~</span>A<span class="sc">+</span>B<span class="sc">+</span>A<span class="sc">*</span>B, <span class="at">data =</span> data.df), <span class="st">&quot;A&quot;</span>)</span></code></pre></div>
<pre><code>## NOTE: Results may be misleading due to involvement in interactions</code></pre>
<pre><code>##  A emmean    SE df lower.CL upper.CL
##  1   -0.3 0.362 34    -1.03   0.4348
##  2   -0.7 0.362 34    -1.43   0.0348
## 
## Results are averaged over the levels of: B 
## Confidence level used: 0.95</code></pre>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="unbalanced-data-in-two-way-anova.html#cb370-1" aria-hidden="true" tabindex="-1"></a><span class="fu">emmeans</span>(<span class="fu">lm</span>(Y<span class="sc">~</span>A<span class="sc">+</span>B<span class="sc">+</span>A<span class="sc">*</span>B, <span class="at">data =</span> data.df), <span class="st">&quot;B&quot;</span>)</span></code></pre></div>
<pre><code>## NOTE: Results may be misleading due to involvement in interactions</code></pre>
<pre><code>##  B emmean    SE df lower.CL upper.CL
##  1   3.05 0.420 34     2.20     3.90
##  2   2.95 0.485 34     1.96     3.94
##  3  -7.50 0.420 34    -8.35    -6.65
## 
## Results are averaged over the levels of: A 
## Confidence level used: 0.95</code></pre>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="unbalanced-data-in-two-way-anova.html#cb373-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(data.df<span class="sc">$</span>Y[data.df<span class="sc">$</span>A<span class="sc">==</span><span class="dv">1</span>])</span></code></pre></div>
<pre><code>## [1] -1.975</code></pre>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="unbalanced-data-in-two-way-anova.html#cb375-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(data.df<span class="sc">$</span>Y[data.df<span class="sc">$</span>A<span class="sc">==</span><span class="dv">2</span>])</span></code></pre></div>
<pre><code>## [1] 0.225</code></pre>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="unbalanced-data-in-two-way-anova.html#cb377-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(data.df<span class="sc">$</span>Y[data.df<span class="sc">$</span>B<span class="sc">==</span><span class="dv">1</span>])</span></code></pre></div>
<pre><code>## [1] 3.033333</code></pre>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="unbalanced-data-in-two-way-anova.html#cb379-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(data.df<span class="sc">$</span>Y[data.df<span class="sc">$</span>B<span class="sc">==</span><span class="dv">2</span>])</span></code></pre></div>
<pre><code>## [1] 2.95</code></pre>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="unbalanced-data-in-two-way-anova.html#cb381-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(data.df<span class="sc">$</span>Y[data.df<span class="sc">$</span>B<span class="sc">==</span><span class="dv">3</span>])</span></code></pre></div>
<pre><code>## [1] -7.333333</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="two-way-anova.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="missing-cells-in-two-way-anova.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/09-UnbalancedTwoWay.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
